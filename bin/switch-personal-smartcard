#!/bin/sh
set -e

mkdir -p ~/.gnupg/sc-toggle-status

touch ~/.gnupg/sc-toggle-status/personal
SC="$(cat ~/.gnupg/sc-toggle-status/personal)"

echo "CURRENT: $SC"
echo
read -p "NEW: " NEW

if [ -n "$NEW" ]
then
  echo "$NEW" > ~/.gnupg/sc-toggle-status/personal
  find ~/.gnupg/private-keys-v1.d -name "C2C10C842FC43BDB6071BEB66E01C85E3087977F.$NEW" | while read f; do cp -a "$f" "${f%.$NEW}.key"; done
  echo "Switching to $NEW"
fi
